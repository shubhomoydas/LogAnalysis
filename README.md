# WeblogChallenge

Project in Scala for analyzing log data from Amazon cloud server.

To compile:

    mvn compile

To build JAR:

    mvn package

To run (make a folder 'output' in order for output files to be generated):

    spark-submit --master local[4] target/WeblogChallenge-0.1.0-jar-with-dependencies.jar <operation> [ip address]
    
The command line options are:

    - operation: [0|1|2|3|4|5|6]
    
        0: generate url / user profile data -- outputs file(s) in 'output' folder
            showing users with longest sessions, etc.
        
        1: generate transition data -- generates transition probability tables for
            all users. Probably not required. But useful for debug.
        
        2: generate transition data and simulate arbitrary user navigation --
            in addition to generating the transition probabilities,
            also simulates navigation. This is also not really required unless debugging.
        
        3: simulate navigation for a client IP (requires ip address) -- Extracts all
            logs for a particular IP and builds transition probability tables. Then
            simulates the user (say) 200 times and reports average session length,
            average number of unique urls, average number of total urls per session.
        
        4: generate time series data for server load -- useful to inspect and understand
            server load charactaristics.
        
        5: generate server load data for regression -- useful only if we have lots of
            data over multiple years. Usefulness is mostly moot at this point for this project.
        
        6: predict load for next minute -- Basically average of last 5 minutes load.
        
    - ip address: client IP -- required only for operation 3 (above).

The predictions by operation 6 match quite well with true values. See: https://github.com/shubhomoydas/WeblogChallenge/blob/master/docs/predicted_server_load.pdf


Below are output files generated by operation '0':

1. output/session_dur.txt -- Orders the user sessions by their duration.
    Seems like most top IPs are either bots or intermediary servers handling data
    for a large number of clients. One of the top IPs 52.74.219.71 is an Amazon server.
    'whois' on random IPs reveals a predominantly Indian client base.
    The output file format is:
    
        ip,session_id,total_navigations,total_time
        
    Top 10 in output:
    
        220.226.206.7,8,292,3248
        52.74.219.71,5,11609,2069
        125.19.44.66,5,906,2068
        106.186.23.95,5,2848,2068
        125.20.39.66,4,409,2068
        119.81.61.166,5,1818,2068
        192.8.190.10,3,172,2067
        54.251.151.39,5,1577,2067
        180.211.69.209,4,132,2066
        202.167.250.59,4,27,2066

2. output/user_duration.txt -- Average times per user. Averaged across multiple sessions
    if more than one session is present for a user.
    File format is:
    
        ip,number_of_sessions,avg_session_duration
        
    Top 10 in output:
    
        103.29.159.138,1,2065.0
        125.16.218.194,1,2064.0
        14.99.226.79,1,2062.0
        117.217.94.18,1,2061.0
        122.169.141.4,1,2060.0
        117.218.61.172,1,2060.0
        180.151.32.147,1,2060.0
        59.97.160.225,1,2059.0
        223.182.246.141,1,2059.0
        59.91.252.41,1,2059.0

3. output/session_unique_url_counts.txt -- number of unique URL visits per session

        ip,session_id,unique_url_count
        
    Sample output:
    
        1.186.101.79,1,10
        1.186.103.240,1,5
        1.186.103.78,1,4
        1.186.108.213,1,2
        1.186.108.230,1,5
        1.186.108.242,1,3
        1.186.108.28,1,5
        1.186.108.29,1,3
        1.186.108.79,1,3
        1.186.111.224,1,11
        
4. output/session_url_count.txt -- total number of URL visits for a session

        ip,session_id,num_url_visits,url
        
5. output/urls.txt -- A summary of URLs across users/sessions

        url_id,url,count_visited,avg_time_from_prev_url_in_session

    Top 20 most frequented URLs:
    
        0,/offer/wp-content/plugins/*,159952,0.49209762928878664
        1,/shop/cart,131395,9.06606796301229
        2,/shop/p/*,101006,17.05522444211235
        3,/papi/v1/promosearch/product/*/offers,88605,6.93959708820044
        4,/,60111,53.34817254745388
        5,/offer/wp-content/uploads/*,59475,1.1549390500210173
        6,/papi/nps/merchantrating,48900,32.4117382413088
        7,/papi/rr/products/*/statistics,47964,4.4135810190976565
        8,/offer/wp-includes/*,46727,0.4910865238513065
        9,/papi//v1/promosearch/product/*/offers,32829,0.13058576258795576
        10,/shop/v1/frequentorders,31720,17.015605296343
        11,/papi/v1/expresscart/verify,25278,35.34876176912731
        12,/shop/orderdetail/*,22238,9.896033815990647
        13,/shop/wallet/balance,21902,7.463975892612547
        14,/shop,19272,17.633561643835616
        15,/shop/login,18018,24.494838494838493
        16,/favicon.ico,17898,14.655715722427086
        17,/shop/summary/*,12210,50.676085176085174
        18,/api/v1/expresscart/checkout,11374,7.95876560576754
        19,/shop/orderhistory,10758,27.508644729503626


Below is the output file generated by operation '1':

1. output/transitions.txt -- transition probabilities and times. This depends on the URL ids in file output/urls.txt. '-2' represents start of session. '-1' represents session end.
    
        from_url_id,to_url_id,probability,time_to_navigate
    
    Some transitions:
    
        -2,837,9.456533045854729E-6,0.0
        -2,483,9.456533045854729E-6,0.0
        -2,1754,9.456533045854729E-6,0.0
        -2,155,4.4445705315517226E-4,0.0
        -2,110,7.848922428059425E-4,0.0
        -2,633,9.456533045854729E-6,0.0
        -2,144,6.241311810264121E-4,0.0
        -2,235,6.61957313209831E-5,0.0
        ...
        28,28,0.11458137347130762,46.847290640394085
        28,46,1.8814675446848542E-4,1260.0
        28,1130,1.8814675446848542E-4,0.0
        28,72,1.8814675446848542E-4,11.0
        28,822,1.8814675446848542E-4,0.0
        28,1052,1.8814675446848542E-4,0.0
        28,1340,1.8814675446848542E-4,0.0
        28,621,1.8814675446848542E-4,0.0
        28,1568,1.8814675446848542E-4,0.0
        28,0,1.8814675446848542E-4,6.0
        28,1685,1.8814675446848542E-4,0.0
        ...
        648,34,0.5,0.0
        648,731,0.5,0.0
        649,6,0.5,52.0
        649,1,0.5,13.0
        650,28,0.5,0.0
        650,43,0.5,0.0
        651,1,1.0,18.5
        652,-1,0.5,0.0
        652,1702,0.5,108.0
        ...


Below is the output file generated by operation '4':

1. output/per_sec_counts.txt -- contains server load per second in a particular minute.
        
        time,minute_of_day,load

    First entries in file (corresponding to earliest times):

        2015-07-22 02:40,160,78.01666666666667
        2015-07-22 02:41,161,113.11666666666666
        2015-07-22 02:42,162,93.1
        2015-07-22 02:43,163,78.9
        2015-07-22 02:44,164,78.0
        2015-07-22 02:45,165,5.383333333333334
        2015-07-22 05:09,309,0.016666666666666666
        2015-07-22 05:10,310,168.31666666666666
        2015-07-22 05:11,311,194.5
        2015-07-22 05:12,312,204.25
